<script>
  async function generatePolicy() {
    const userInput = document.getElementById('points').value;
    const replyDiv = document.getElementById('reply');
    const downloadBtn = document.getElementById('downloadBtn');

    replyDiv.style.display = 'block';
    replyDiv.innerText = 'Generating policy draft...';

    try {
      const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
        method: 'POST',
        headers: {
          'Authorization': 'Bearer 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',
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          model: 'openai/gpt-3.5-turbo',
          messages: [{ role: 'user', content: userInput }]
        })
      });

      const data = await response.json();
      replyDiv.innerText = data.choices?.[0]?.message?.content || 'No response from AI.';
      downloadBtn.style.display = 'inline-block';
    } catch (err) {
      replyDiv.innerText = 'Error contacting the AI.';
    }
  }

  function downloadDocx() {
    const text = document.getElementById('reply').innerText;
    const blob = new Blob([text], { type: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = 'PolicyDraft.docx';
    link.click();
  }
</script>